
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><!-- InstanceBegin template="/Templates/designTemplate.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<style type="text/css">
  .centeredImage
    {
    text-align:center;
    margin-top:0px;
    margin-bottom:0px;
    padding:0px;
    }
</style>

<meta name="keywords" content="">

<meta name="description" content="">

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<!-- InstanceBeginEditable name="doctitle" -->
<title>Rodrigo Araújo ::: Software Engineer / Computer Scientist</title>


<!-- InstanceEndEditable -->

<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href="../../../../../css/stylesheet.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="../../../../../css/styles/github.css">
<script src="../../../../../highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script><!--[if IE]>

<style type="text/css"> 
/* place css fixes for all versions of IE in this conditional comment */
.twoColHybRtHdr #sidebar1 { padding-top: 30px; }
.twoColHybRtHdr #mainContent { zoom: 1; padding-top: 15px; }
/* the above proprietary zoom property gives IE the hasLayout it may need to avoid several bugs */
</style>
<![endif]-->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

</head>

<body class="twoColHybRtHdr">
        <div class="sidebar" style="height:100%;">
<div id="container"><!-- InstanceBeginEditable name="headerNav" -->
  <div id="header" style='margin-top:-30px;padding-bottom:25px;'>
    
      <tr>
        <h1><a href="../../../../../index.html">Rodrigo Araújo</a></h1>
      </tr>
        <h4>Software Engineer & Computer Scientist</h4>

    
    <tr>
    </tr>
    <tr>
      <h3 style="padding-top:10px; margin-left:2px;">
        <!--<a href="./HomePage.html"><img src="./images/back.png" width="15"></a>
              <tr>
        <td>&nbsp;</td>
      </tr><-->

        <a href="/blog/" onclick="">BLOG    &nbsp;&nbsp;</a> 
        <a href="/about/">ABOUT    &nbsp;&nbsp;</a>
        <a href="/work/">WORK    &nbsp;&nbsp;</a>
        <a href="/contact/">CONTACT    &nbsp;&nbsp;</a>
      </h3>
    </tr>
    
    <!-- end #header -->
  </div>
  
  <div style="width:390px; margin-top:0px;" id="sidebar">
       <ul>
               <hr/>
          <li style="font-size:22px;"><a href="/archives/">Archives</a></li>
          <hr/>
      </ul>
</div>  

  <div style="margin-left:180px;margin-top:-158px;" id="mainContent" class="hidden">
    
    <ul>
  
    <li>
	<h1>
      <a href="/2015/05/25/Scaling-Python:-Using-Redis-as-Cache/">
	
	<div style="line-height:35px;color:#444;">Web Scaling: Using Redis as Cache</div>
	
	</a>
	</h1>
	<div style="margin-top:-15px;color:#E11F00;">25 May 2015</div>
        &nbsp;
      <p><style>
.hljs{
        font-size:12px;
}
</style>
<html>
        <p><strong>Redis is such a great technology.</strong> Unfortunately, there's still people who doesn't know Redis or doesn't know that Redis can be used as a Cache System to improve the speed of responses. </p>
&nbsp;

<p><h2>Why Redis</strong></h2>

<p>Well, let's start this discussion remembering how a common Relational Database basically works: Suppose we're using a MySQL, every time your app send a request to the MySQL client, the MySQL client gotta make a trip to the hard drive to get the data asked in the request, this can become a problem if the data asked in request is big... and if there are many requests at the same time, this can generate a huge latency, annoying users or worse. </p>

<p>This is where Redis comes into play, Redis is a key-value database that will be running and storing data inside your memory, if you remember the basic of computers architecture: </p>
<img src="/images/memchart.jpg">


<p>It's way faster to access data in the memory (Physical RAM, main memory) than to access data in the Hard Drive, so it's easy to notice that if the data that the application wants to access is inside the main memory, it's way easier to reach to that data than if it was stored in the Hard Drive.</p>

<p>So, like I said, Redis will be storing its data inside the memory, but you may ask yourself: "but what if I turn off the machine?? isn't the ram memory volatile? " Yes, that's why Redis will be flushing the data to the hard drive from time to time, it's up to you to choose this time between flushes, it's all about Performance vs. Security.</p>

<p>So, What we'll be doing is just:</p>
<div align="center">

<div class="sequence-diagram"><svg height="528" version="1.1" width="355.875" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative;"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with RaphaÃ«l 2.1.2</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><marker id="raphael-marker-endblock55-obj1776" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj1781" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj1784" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj1787" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj1792" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj1795" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj1798" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj1801" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj1804" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj1807" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="10" y="20" width="44.8125" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="20" y="30" width="24.8125" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="32.40625" y="39.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">App</tspan></text><rect x="10" y="469" width="44.8125" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="20" y="479" width="24.8125" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="32.40625" y="488.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">App</tspan></text><path fill="none" stroke="#000000" d="M32.40625,59L32.40625,469" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="108.328125" y="20" width="54.46875" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="118.328125" y="30" width="34.46875" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="135.5625" y="39.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Redis</tspan></text><rect x="108.328125" y="469" width="54.46875" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="118.328125" y="479" width="34.46875" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="135.5625" y="488.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Redis</tspan></text><path fill="none" stroke="#000000" d="M135.5625,59L135.5625,469" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="262.6875" y="20" width="63.1875" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="272.6875" y="30" width="43.1875" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="294.28125" y="39.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">MySQL</tspan></text><rect x="262.6875" y="469" width="63.1875" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="272.6875" y="479" width="43.1875" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="294.28125" y="488.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">MySQL</tspan></text><path fill="none" stroke="#000000" d="M294.28125,59L294.28125,469" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="42.40625" y="74.5" width="83.15625" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="83.984375" y="84" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Request data</tspan></text><path fill="none" stroke="#000000" d="M32.40625,98C32.40625,98,109.93753726221621,98,130.5696425151009,98" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj1776)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="160.5625" y="118" width="82.96875" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="202.046875" y="127.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">No key found</tspan></text><path fill="none" stroke="#000000" d="M135.5625,113L155.5625,113" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M155.5625,113L155.5625,147" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M155.5625,147C155.5625,147,146.4816131591797,147,140.5577533841133,147" stroke-width="2" stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj1781)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="173.34375" y="152.5" width="83.15625" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="214.921875" y="162" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Request data</tspan></text><path fill="none" stroke="#000000" d="M135.5625,176C135.5625,176,262.3245228412561,176,289.2800213507127,176" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj1784)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="177.625" y="191.5" width="74.59375" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="214.921875" y="201" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Return data</tspan></text><path fill="none" stroke="#000000" d="M294.28125,215C294.28125,215,167.5192271587439,215,140.56372864928733,215" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj1787)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="160.5625" y="235" width="118.71875" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="219.921875" y="244.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">set data into cache</tspan></text><path fill="none" stroke="#000000" d="M135.5625,230L155.5625,230" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M155.5625,230L155.5625,264" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M155.5625,264C155.5625,264,146.4816131591797,264,140.5577533841133,264" stroke-width="2" stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj1792)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="48.4375" y="269.5" width="71.09375" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="83.984375" y="279" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">return data</tspan></text><path fill="none" stroke="#000000" d="M135.5625,293C135.5625,293,58.03121273778379,293,37.399107484899105,293" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj1795)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="42.40625" y="308.5" width="83.15625" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="83.984375" y="318" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Request data</tspan></text><path fill="none" stroke="#000000" d="M32.40625,332C32.40625,332,109.93753726221621,332,130.5696425151009,332" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj1798)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="48.4375" y="347.5" width="71.09375" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="83.984375" y="357" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">return data</tspan></text><path fill="none" stroke="#000000" d="M135.5625,371C135.5625,371,58.03121273778379,371,37.399107484899105,371" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj1801)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="42.40625" y="386.5" width="83.15625" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="83.984375" y="396" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Request data</tspan></text><path fill="none" stroke="#000000" d="M32.40625,410C32.40625,410,109.93753726221621,410,130.5696425151009,410" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj1804)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="48.4375" y="425.5" width="71.09375" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="83.984375" y="435" text-anchor="middle" font-family="Andale Mono, monospace" font-size="13px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 13px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">return data</tspan></text><path fill="none" stroke="#000000" d="M135.5625,449C135.5625,449,58.03121273778379,449,37.399107484899105,449" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj1807)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg></div>
</div>

<p><strong>As you can see: So much win. We avoided redundant trips to the disk.</p></strong>
<p>Now that we understand the concept of what we'll be doing, the code becomes very easy to implement, here's a simple idea <em>(thought it can be improved and extended in many ways, but it can demonstrate the idea we're working here)</em></p>

<pre>
<code class="python hljs"> 
from flask import Flask
from flask.ext.sqlalchemy import SQLAlchemy
from sqlalchemy import create_engine
import redis

app = Flask(__name__)
url = 'mysql+pymysql://username:password@ip/dbname'
app.config['SQLALCHEMY_DATABASE_URI'] = url
db = SQLAlchemy(app)
cache = redis.StrictRedis(host='localhost', port=6379, db=0)

#improvement: model could stay in a different file
class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(80))
    email = db.Column(db.String(120))

    def __init__(self, username, email):
        self.username = username
        self.email = email

    def __repr__(self):
        return '<User %r>' % self.username

def createUsers():
        for x in xrange(0,100000):
            user = User('test', 'test')
            db.session.add(user)
        db.session.commit()

def getUsers():
        users = cache.get('users')
        if not users:
            users = User.query.all()
            cache.set('users', users)

# improvement: views/routing should stay in a different file
@app.route('/')
def hello_world():
    getUsers()
    return 'Hello Worldd!'

if __name__ == '__main__':
    app.debug=True
    app.run(host='0.0.0.0')

</code>
</pre>

<p>So, after you create the correct database, populate the database (there's a function in the code for that) and change username/password/dbname in the code, we'll run the app.py and go to localhost:port-you-exposed.</p>
&nbsp;

<h2><em>What will happen?</em></h2>

<p>1. The first time you access it, it will take a few seconds to get the data from the MySQL</p>
<p>2. The second time you access it, it will take just a few milliseconds to get the same data from redis</p>

<p>In my computer the result was:</p>
<p>first access: 45861 milliseconds</p>
<p>second access: 5ms</p>

<strong><p>I know, right? That's just blazing fast!</p></strong>

<p>And it can save a lot of computational resources and human time. Now, with this logic applied to one method (the method to get users), we can apply it to whichever method we want, or we can even create a generic decorator and annotate the methods that we want do the caching!! </p>





</html>


</p>
    </li>
    <hr/>
    &nbsp;
  
    <li>
	<h1>
      <a href="/2015/04/22/Build-your-first-Rest-API-with-Python/">
	
	<div style="line-height:35px;color:#444;">Building your first Rest API with python</div>
	
	</a>
	</h1>
	<div style="margin-top:-15px;color:#E11F00;">22 April 2015</div>
        &nbsp;
      <p><html>

<p>Are you total lost in this world full of jargons like: API, Rest API, microservices and stuffs? Come here, sit, grab a cup of coffee, and let's talk briefly about it.</p>

<p>Today a lot is said about APIs. Everything has an API, every programmer (newbie to expert) uses tons of API. Also, today we can see a lot of people talking about microservices and the idea of total separation of backend, frontend, web services or <em>whatever</em>. So we can <em>(and we do)</em> hear a lot about REST/RESTful APIs. We have 3 current problems with it:</p>


<p>1. Many new programmers don’t have a single clue of what a Rest API is.</p>
<p>2. It’s probable that they’re using Rest APIs and don’t know about it.</p>
<p>3. When they feel that they should learn more about it, there’s hardly any good and accessible material to learn it.</p>


&nbsp;
<h3 id="so-heres-a-extremely-simplistic-approach-to-try-to-explain-what-is-a-rest-api">So here’s a extremely simplistic approach to try to explain what is a Rest API</h3>

<p>Starting with the concept of API, which stands for <strong>A</strong>pplication <strong>P</strong>rogramming <strong>I</strong>nterface, it’s just an interface which you, <em>dear programmer</em>, will be dealing with to extract whatever you <em>(or your program)</em> want.</p>

<p>Suppose your program needs to create a connection with a given database, normally you do:</p>

<p>1. You import the <em>library</em> that will abstract the connection with the database</p>
<p>2. You create an object to represent a Connection with the database</p>
<p>3. You call functions that this object provide to you, so you can do whatever you want (and whatever they provide)</p>

<p>Here's a silly example:</p>

<pre>
<code class="hljs python">
from database_library import Connection

connection = Connection()
connection.OpenConnection()
… do whatever you want
connection.CloseConnection()
</code>
</pre>

<p>When you called those function, you were dealing with the interface that the object provided to you, sure the object may be doing thousand of things at the moment you call its functions, but, it doesn’t matter to you, does it? You just want the <em>damn</em> connection open and then closed.</p>

<p>So the library that you imported is giving you something you want, offering a service or a resource. That’s the sole purpose of an API. It’s a layer that you can use to get things from other(s) component(s).</p>

<p>So, it’s easy to deduct that, the better the engineer planned the API, the easier it will be to deal with and extract what you want, and the contrary is true.</p>

<p>But still, you're processing the core of this API in your own machine, which isn’t that great, here’s when the API evolves to whole web hosted services, so you can request this API something, and this API can give you something, through the WEB, via HTTP request. And that’s amazing.</p>

<p>And the community, recently, decided that the request and response that happen between applications and APIs, should be done with JSON, so this communication can become uniform and APIs can talk to other APIs effortlessly.</p>

<p>So, basically, what’s going on is:</p>



<div class="sequence-diagram"><svg height="216" version="1.1" width="279.6875" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; top: -0.4375px;"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.1.2</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><marker id="raphael-marker-endblock55-obj1238" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj1241" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="10" y="20" width="106.53125" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="20" y="30" width="86.53125" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="63.265625" y="39.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 12px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Your Program</tspan></text><rect x="10" y="157" width="106.53125" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="20" y="167" width="86.53125" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="63.265625" y="176.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 12px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Your Program</tspan></text><path fill="none" stroke="#000000" d="M63.265625,59L63.265625,157" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="189.53125" y="20" width="60.15625" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="199.53125" y="30" width="40.15625" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="219.609375" y="39.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 12px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">An API</tspan></text><rect x="189.53125" y="157" width="60.15625" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="199.53125" y="167" width="40.15625" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="219.609375" y="176.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 12px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">An API</tspan></text><path fill="none" stroke="#000000" d="M219.609375,59L219.609375,157" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="96.828125" y="74.5" width="89.21875" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="141.4375" y="84" text-anchor="middle" font-family="Andale Mono, monospace" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 12px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Gibe me stuffs</tspan></text><path fill="none" stroke="#000000" d="M63.265625,98C63.265625,98,187.8921682741493,98,214.60654937637173,98" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj1238)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="73.265625" y="113.5" width="136.34375" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="141.4375" y="123" text-anchor="middle" font-family="Andale Mono, monospace" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 12px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Here, Take your stuffs</tspan></text><path fill="none" stroke="#000000" d="M219.609375,137C219.609375,137,94.9828317258507,137,68.26845062362827,137" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj1241)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg></div>

<p>So your program can keep working just fine, with the data provided by the API. More detailed:</p>



<div class="sequence-diagram"><svg height="216" version="1.1" width="345.09375" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; top: 0.96875px;"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.1.2</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><marker id="raphael-marker-endblock55-obj8222" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj8225" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="10" y="20" width="106.53125" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="20" y="30" width="86.53125" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="63.265625" y="39.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 12px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Your Program</tspan></text><rect x="10" y="157" width="106.53125" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="20" y="167" width="86.53125" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="63.265625" y="176.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 12px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Your Program</tspan></text><path fill="none" stroke="#000000" d="M63.265625,59L63.265625,157" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="254.9375" y="20" width="60.15625" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="264.9375" y="30" width="40.15625" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="285.015625" y="39.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 12px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">An API</tspan></text><rect x="254.9375" y="157" width="60.15625" height="39" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="264.9375" y="167" width="40.15625" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="285.015625" y="176.5" text-anchor="middle" font-family="Andale Mono, monospace" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 12px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">An API</tspan></text><path fill="none" stroke="#000000" d="M285.015625,59L285.015625,157" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="73.265625" y="74.5" width="201.75" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="174.140625" y="84" text-anchor="middle" font-family="Andale Mono, monospace" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 12px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">*(HTTP Request)* GET /resource</tspan></text><path fill="none" stroke="#000000" d="M63.265625,98C63.265625,98,247.15701526403427,98,280.0204180162982,98" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj8222)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="105.546875" y="113.5" width="137.1875" height="19" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="174.140625" y="123" text-anchor="middle" font-family="Andale Mono, monospace" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: 'Andale Mono', monospace; font-size: 12px;"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">JSON of that resource</tspan></text><path fill="none" stroke="#000000" d="M285.015625,137C285.015625,137,101.12423473596573,137,68.26083198370179,137" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj8225)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg></div>

<p>So, yes, you make your function calls, now, with just a simple URL + HTTP methods, wanna see a real example? We can just send a request to the Facebook’s API by accessing this URL: <a href="http://graph.facebook.com/contatodigo">http://graph.facebook.com/contatodigo</a></p>

<p>Which will request my profile’s data, and the Facebook’s API will return:</p>

<pre><code>{
   "id": "100001638888259",
   "first_name": "Rodrigo",
   "gender": "male",
   "last_name": "Ara\u00fajo",
   "link": "https://www.facebook.com/contatodigo",
   "locale": "pt_BR",
   "name": "Rodrigo Ara\u00fajo",
   "username": "contatodigo"
}
</code></pre>

<p>As simple as that.</p>

<p>Now with this basic idea explained, we can do a simple Rest API using Python and Flask. (I’m assuming you’re already familiar with both technologies).</p>

<p>All we’re gonna do is, using the flask routing, create routes to the users so they can interact with the resources of our API. Let’s suppose our API will serve and receive only Books. So this is the resource we’re dealing with, users may use our API to get Books and insert new Books, so our only URIs will be:</p>


<p>1. <em>/bookapi/v1.0/books</em> with a GET method, which will just return the list of books</p>
<p>2. <em>/bookapi/v1.0/books</em> with a POST method, which will insert a book</p>

<p>So after the API is built, you or you program can get books or insert books by sending HTTP request to the API’s URIs, simple as that. I’ll be very straight forward, here’s the code:</p>

<pre>
<code class="hljs python">
#!flask/bin/python
from flask import Flask, jsonify, request

app = Flask(__name__)

books = [
    {
        'id': 1,
        'title': u'Game of Thrones',
        'description': u'Cool dragons', 
        'finished': False
    },
    {
        'id': 2,
        'title': u'50 shadows of grey',
        'description': u'It start as bullshit, end as a huge bullshit', 
        'finished': True
    }
]

@app.route('/bookapi/v1.0/books/', methods=['GET'])
def get_books():
    return jsonify({'books': books})

@app.route('/bookapi/v1.0/books', methods=['POST'])
def create_book():
    if not request.json or not 'title' in request.json:
        abort(404)
        
    book = {
            'id': books[-1]['id'] + 1,
            'title': request.json['title'],
            'description': request.json.get('description', ""),
            'finished': False
            }

    books.append(book)
    return jsonify({'book': book}), 201 


if __name__ == '__main__':
    app.run(debug=True)


</code>
</pre>

<p>Note that we’re creating a simple in-memory <em>database</em>, which is a simple python’s dict. This could be a database. But for the sake of simplicity, I'm using just a dict.</p>

<p>When the requests come, it verifies the route that the user is asking for, which is: what resources is he/she wanting? and then, the code do whatever it must do (<em>remember the API idea of hiding the complexity, the user requesting just want the result</em>), and then it put everything in a JSON and returns it. That simple! </p>

<p>Of course, many improvements and extensions (<em>there are infinity possibilities</em>) can be made to this code, but, here’s a skeleton of the idea of an API, it’s just a start. One good practice it’s to <em>not</em> return the ID of the resource, but return just its URI, which is surely a great idea. Another good practice is to ask authentication in every HTTP request, so your API won’t be exposed to everybody. There are, indeed, endless improvements, but in this code, you, that are completely beginner to the API’s concept, can now understand what’s going on underneath and start planning and building your own API using Flask. </p>

</html>


</p>
    </li>
    <hr/>
    &nbsp;
  
    <li>
	<h1>
      <a href="/2015/03/31/using-python-and-AI-to-predict-types-of-wine/">
	
	<div style="line-height:35px;color:#444;">Using Python and AI to predict types of wine</div>
	
	</a>
	</h1>
	<div style="margin-top:-15px;color:#E11F00;">31 March 2015</div>
        &nbsp;
      <p><html>
        <p>
        I've been working with AI/Machine Learning at <a href="http://www.jusbrasil.com.br/">Jusbrasil</a> recently, and it's being pretty challenging due to the <em>huge</em> amount of data that we have to deal with, so cleaning this data and making predictions and classifications in an acceptable time demands a nice AI architecture.</p>
        <p>
                That said I can say that I'm extremely thankful for a few technologies that are helping me go through this challenge <em>(and the pain of cleaning this amount of data)</em>: Python, Scikit Learn, Pandas, and the whole stack that the Scikit Learn use, such as NumPy, SciPy, matplotlib and few others.</p>

        <p>
        So, this inspired me to <em>spread the word</em>, so I'll be showing here a simple example of Machine Learning using Python, Pandas and Scikit Learn to predict, given a great amount of data/features about wines, if a wine is white or red.
        </p>

        <p>
        <strong>disclaimer:</strong><em> I'm assuming that you already have a small knowledge on the ideas of the machine learning and its mathematical aspects (although not necessary to implement the code that I'll show here), this is just a simple introduction to scikit learn and its power, so the example is pretty simple and straight forward, if you just want the code, here it is: <a href="https://gist.github.com/digorithm/ad742f9314f76e732888">github link</a> </em>
        </p>
&nbsp;
        <h2>What's Pandas?</h2>
        <p>Pandas is an amazing library for data manipulation, it makes the process of dealing with data very easy and straight forward, we can work with CSV, JSON and plenty other formats without struggling to manipulate the data, <a href="https://signalvnoise.com/posts/3124-give-it-five-minutes">give it five minutes</a> and skim their <a href="http://pandas.pydata.org/pandas-docs/dev/">docs</a>, it will definitely worth it! </p>
&nbsp;
        <h2>Fetching the data</h2>

        <p>
        Let's start fetching the data with Pandas, <em>(you can download the data <a href="https://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/">here</a>)</em> to do so, just import Pandas and read the CSV file, just like that:
        </p>

        <pre>
        <code class="hljs python">
import pandas as pd
        
reds = pd.read_csv('winequality-red.csv', sep=';')
whites = pd.read_csv('winequality-white.csv', sep=';')
        </code>
        </pre>
        <p style="margin-top:-20px;">
        We can see how the data is structured by doing a few commands:
        </p>
        <pre>
        <code class="hljs python">

reds.values[0:6]

        </code>
        </pre>
        <p style="margin-top:-40px;">As output, we have the first 5 rows of the red wine's data</p>
        <pre>
        <code class="hljs">

array([[7.4, 0.7, 0.0, 1.9, 0.076, 11.0, 34.0, 0.9978, 3.51, 0.56, 9.4, 5],
       [7.8, 0.88, 0.0, 2.6, 0.098, 25.0, 67.0, 0.9968, 3.2, 0.68, 9.8, 5],
       [7.8, 0.76, 0.04, 2.3, 0.092, 15.0, 54.0, 0.997, 3.26, 0.65, 9.8, 5],
       [11.2, 0.28, 0.56, 1.9, 0.075, 17.0, 60.0, 0.998, 3.16, 0.58, 9.8,6],
       [7.4, 0.7, 0.0, 1.9, 0.076, 11.0, 34.0, 0.9978, 3.51, 0.56, 9.4, 5],
       [7.4, 0.66, 0.0, 1.8, 0.075, 13.0, 40.0, 0.9978, 3.51, 0.56, 9.4, 5]], 
dtype=object)
        </code>
        </pre>
        <p>Or we just use a function from Pandas that describe very well our data</p>
        <pre>
        <code class="hljs python">

reds.head()

        </code>
        </pre>
        <pre style="margin-top:-65px;">
        <code class="hljs">
       <class 'pandas.core.frame.DataFrame'>
Int64Index: 5 entries, 0 to 4
Data columns:
fixed acidity           5  non-null values
volatile acidity        5  non-null values
citric acid             5  non-null values
residual sugar          5  non-null values
chlorides               5  non-null values
free sulfur dioxide     5  non-null values
total sulfur dioxide    5  non-null values
density                 5  non-null values
pH                      5  non-null values
sulphates               5  non-null values
alcohol                 5  non-null values
quality                 5  non-null values
dtypes: float64(11), int64(1), object(1)
        </code>
        </pre>

        <h2> Understanding our data </h2>
        <p>
        Matplotlib gives you many ways to plot our data into graphs so we can understand what is going on with the data so we can choose the best model/algorithm for the given scenario,
        </p>
        <p>
        For instance, let's take a look at the relation between the red wines and its fixed acidity 
        </p>
        <pre>
        <code class="python hljs">
x = plt.subplots(figsize=(10, 5))
plt.plot(reds.index, reds.get("fixed acidity"), 'ro')
ax.set_title('Wines vs fixed acidity')
ax.set_xlabel('red wine index')
ax.set_ylabel('Fixed Acidity')
plt.show()
        </code>
        </pre>
        <img src="/images/mlproblem.png" style="margin-left:-55px;margin-top:-20px;" width=800 height=400/>
      &nbsp;
        <h2>Preparing the Data for classification</h2>
        <p>
        Now we're going to add a new feature/variable to our data, which is our target variable, the <em>Y</em>, that will be telling if the wine from our dataset is white or red
        </p>
        <pre>
        <code class="python hljs">
reds['kind'] = 'red'
whites['kind'] = 'white'
        </code>
        </pre>

        <p style="margin-top:-20px;">
        We need to get all of our feature into a vector called X, that will be set into our algorithm, right? And, we need to get all our targets (white or red) and set into a Y variable
        </p>
        <pre>
        <code class="python hljs">
wines = reds.append(whites, ignore_index=True)
X = wines.ix[:, 0:-1]
y = wines.kind
        </code>
        </pre>
        <p style="margin-top:-20px;">
        Notice that we're merging both datasets together, the one with the red wines and the one with the white wines, so we can send them together to the algorithm. Now we're going to binarize the labels 'white' and 'red', so the mathematical model can use it. It's pretty simple
        </p>
        <pre>
        <code class="python hljs">
y = y.apply(lambda val: 0 if val == 'white' else 1)
        </code>
        </pre>

        <h2>The algorithm</h2>
        <p>
        Now that we have our data well structured and we do understand it, we can start looking for an algorithm to use. A good algorithm for our scenario is a simple <strong>Logistic Regression</strong>, that will return a model that we'll use to make our predictions/classification. The mathematical linear model that will use is the following:
        </p>
        <span style="font-size:16px;">
        $$
        f(w) := \lambda\, R(w) + \frac1n \sum_{i=1}^n L(w;x_i,y_i) \label{eq:regPrimal}\
        $$
        </span>

        <p>In addition with the loss function defined by the logistic loss</p>
        <span style="font-size:16px;">
        $$
        L(w;x,y) :=  \log(1+\exp( -y w^T x ))
        $$
        </span>

        <p>The Scikit learn provides an awesome library with an amazingly ease of use, so that we don't have to implement the whole model from scratch. All we have to do is create a object from the model we want to use, understand how it works <em>(at least understand how to use its interface to do what we want)</em>. In this case, we will be using the <em>cross validation</em> object, which is another discussion for another time, but in a few words, it will divide our dataset and test it against all parts of the divided dataset, this way we make sure that we're validating the quality of the result. </p>
        <pre>
        <code class="python hljs">
clf = LogisticRegression()
scores = cross_val_score(clf, X, y, cv=5)
print scores.mean(), scores.std()
        </code>
        </pre>
        <p>And as the result we get:</p>
        <pre>
        <code class="python hljs">
0.981376321334 0.00638795038332
        </code>
        </pre>
        <p style="margin-top:-25px;">
        And that's the exactly the precision of the algorithm over the given dataset, <strong>98% of precision</strong>, which is quite good! Now, for example, we can save this trained classifier and use it for future classifications of incoming data about wines that need to be classified as white or red, to do so, we just call the method <em>clf.predict(X) </em> where this X will be the new wine's data. simplicity at its best! 
        </p>

</html>


</p>
    </li>
    <hr/>
    &nbsp;
  
  &nbsp;
  &nbsp;
  &nbsp;
        <div style="width:95%;display:block-inline;font-size:20px; margin-left:12px;">
                
                

                <div style="font-family:'proregular';float:right;"><a href="/blog/page2/">Older Posts -></a></div>
                


        </div>
</ul>


  </div>


<!-- InstanceEndEditable --><!-- InstanceBeginEditable name="subNav" --><!-- InstanceEndEditable --><!-- InstanceBeginEditable name="mainContent" --><!-- InstanceEndEditable -->
  <!-- This clearing element should immediately follow the #mainContent div in order to force the #container div to contain all child floats -->
  <br class="clearfloat" />
  <!-- InstanceBeginEditable name="footer" -->
  <div id="footer">
    <!-- end #footer -->
    </div>
  <!-- InstanceEndEditable -->
  <!-- end #container --></div>
    

</body>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<script>


var fixmeTop = $('#sidebar').offset().top;       // get initial position of the element

$(window).scroll(function() {                  // assign scroll event listener

    var currentScroll = $(window).scrollTop(); // get current position

    if (currentScroll + 20 >= fixmeTop) {           // apply position: fixed if you
        $('#sidebar').css({                      // scroll to that element or below it
            position: 'fixed',
            top: '0',
	    'margin-top':'0px',
            'left': '200'
        });
    } else {                                   // apply position: static
        $('#sidebar').css({                      // if you scroll above it
            position: 'static',
            'margin-top': '0px',
            'left':'200px'
        });
    }

});


$(document).ready(function(){
    // to fade in on page load
   $("#mainContent").fadeIn(1500).removeClass("hidden");
   $('a').click(function(e){
        redirect = $(this).attr('href');
        e.preventDefault();
        $('#mainContent').fadeOut(500, function(){
            document.location.href = redirect
        });
    });
})

</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38327934-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- InstanceEnd --></html>
